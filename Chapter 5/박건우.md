# 5장 책임 할당하기

요약 : 책임 주도 설계의 구체적인 방법론 제시 
   
(도메인 모델, GRASP 패턴, 데이터 주도 설계 후 리팩토링)

---

### 책임 주도 설계


**[ 과정 ]** 

1. 시스템 책임 파악
2. 시스템 책임을 더 작은 책임으로 분할 
3. 적절한 객체 또는 역할을 찾아 책임 할당
4. 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요하면 적절한 객체 또는 역할을 찾는다.
5. 해당 객체에게 책임할당 -> 협력

**[ 중요한 점 ]**

- 데이터 보다 행동(책임)을 먼저 결정해라
- 협력이라는 문맥 안에서 책임을 결정해라
- 메시지를 결정한후에 객체를 선택해라
- 메시지는 항상 클라이언트(메시지 전송자) 관점에서 설계해라. 그렇게 해야 캡슐화가 깔끔하게 된다
  (수신자에 대한 가정을 할 수 없음)

---

### 도메인 개념(모델)

- 도메인에 대한 개략적인 모습
- 설계의 출발점
  - 시작 단계에서 도메인 모델이 완벽할 필요는 없다
  - 코드를 구현하면서 도메인 모델이 변경될 수 있다
- 도메인 모델은 구현의 기반이 된다

---

## GRASP 패턴

객체에게 책임을 할당할 때 지침들

<br>

### 정보 전문가 패턴

해당 책임에 대한 정보를 가장 잘 알고있는 객체에게 책임을 할당하자


[ 정보? ] 

- 데이터
- 다른 객체에대한 정보
- 객체내부에서 필요한 정보를 계산해서 도출

<br>

### LOW COUPLING, HIGH COHESION 패턴

낮은 결합도와 높은 응집도를 만족할 수 있도록 책임을 할당하자

Screening 객체가 DiscountCondition 객체와 협력한다면?

**[ 결합도 관점 ]**
- Screening 객체에  DiscountCondition 객체에 관한 결합도 추가

**[ 응집도 관점 ]**
- Screening 객체의 가장 중요한 책임은 예매를 생성하는 것
- 하지만 DiscountCondition 객체와 협력하면 요금 계산과 관련된 책임을 일부 떠안게 된다. 

<br>

### CREATOR 패턴

객체를 생성할 책임을 누구에게 할당해야하는가?

-> 생성할 객체와 긴밀하게 결합된 객체

이미 결합된 객체에게 생성 책임을 할당하는 것은 설계 전체적인 결합도에 영향을 미치지 않는다.

<br>

### 다형성(POLYMORPHISM) 패턴

객체의 타입에 따라 변하는 행동이 있다면,

타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당하자

- DiscountCondition
- 기존 
  - enum 으로 표현하는 암시적인 타입이 존재
- 리팩토링
  - Movie 입장에서는 구체적으로 무슨 할인 조건인지는 중요하지 않음 -> 즉 둘 다 동일한 역할
  - 인터페이스로 추상화
  - 암시적 타입을 명확한 타입으로 분리 -> 응집도 상승 

### PROTECTED VARIATION 패턴

변경을 캡슐화하도록 책임을 할당하자

- 할인 조건을 추가하더라도 외부에 변경에 대한 임팩트가 퍼지지 않음
- DiscountCondition 뒤로 완벽하게 캡슐화하였기 때문

---

### 책임 주도 설계의 대안

책임 주도 설계가 익숙하지 않다면 데이터중심 설계를 먼저하고 리팩토링을 하자

1. 메서드를 분할하여 메서드 응집도를 높임 
2. 메서드를 관련된 클래스로 이동

